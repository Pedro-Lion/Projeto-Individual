<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login</title>
    <link rel="stylesheet" href="./css/login-final.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
    <link rel="shortcut icon" href="imgs/logo-removebg-preview.png" type="image/x-icon">
    <script src="https://kit.fontawesome.com/59e6ac5157.js" crossorigin="anonymous"></script>
    

</head>
<body>
    <!--HEADER-->
    <header id="scroll-element">
        <nav class="navbar">
            <a href="#" class="nav-logo">
                <div class="logo-nome">
                    <img src="imgs/logo-removebg-preview.png" style="height: 100px; margin-top: 10px; width: auto; ">
                    <h1 class="Titulo1">Filosofia Inata</h1>
                </div>
                <!-- <h1 class="Titulo1">Filosofia Inata</h1>-->
            </a>
            <ul class="nav-menu">
                <li class="nav-item">
                    <a href="index.html" class="nav-link">Início</a>
                </li>
                <li class="nav-item">
                    <a href="#menu" class="nav-link">Vertentes</a>
                </li>
                <li class="nav-item">
                    <a href="#about" class="nav-link">Sobre</a>
                </li>
                <li class="nav-item">
                    <a href="login.html" class="nav-link">Login</a>
                </li>
                <li class="nav-item">
                    <a href="cadastro-empresa.html" class="nav-link">Cadastro</a>
                </li>
            </ul>
        </nav>
    </header>
    <!--Mensagens de Ação-->
    <div class="alerta_erro">
        <div class="card_erro" id="cardErro">
          <span id="mensagem_erro"></span>
        </div>
      </div>

    <!--Tela Cadastro-->
    <section class="hero-section" id="section-image">
      <div class="bloco">
        <!--<div class="section-content">-->
         <!-- <div class="hero-details"> -->
                <div class="container">
                    <div class="content first-content">
                        <div class="first-column">
                            <h2 class="title title-welcome">Bem Vindo de Volta!</h2>
                            <p class="description description-primary">Se já possui um cadastro,</p>
                            <p class="description description-primary">Logue e veja seus resultados!</p>
                            <button id="Logar" class="btn btn-primary">Logar</button>
                        </div>
                        <div class="second-column">
                            <h2 class="title title-second">Crie Sua Conta!</h2>
                            <div class="social-media">
                                <ul class="list-social-media">
                                    <a class="link-social-media" href="#">
                                        <li class="item-social-media">
                                            <i class="fa-brands fa-github"></i>
                                        </li>
                                    </a>
                                    <a class="link-social-media" href="#">
                                        <li class="item-social-media"><i class="fa-brands fa-linkedin"></i>
                                        </li>
                                    </a>
                                    <a class="link-social-media" href="#">
                                        <li class="item-social-media"><i class="fa-brands fa-instagram"></i>
                                        </li>
                                    </a>
                                </ul>
                            </div>
                            <p class="description description-second">ou use seu email para criar uma conta:</p>
                            <form class="form" onsubmit="return false">
                                <label class="label-input" for="">
                                    <i class="fa-solid fa-user icon-modify"></i>
                                <input type="text" placeholder="Nome" id="nome_input">
                                </label>
                                <label class="label-input" for="">
                                    <i class="fa-solid fa-envelope icon-modify"></i>
                                <input type="text" placeholder="E-mail" id="email_input">
                                </label>
                                <label class="label-input" for="">
                                    <i class="fa-solid fa-lock icon-modify"></i>
                                <input type="text" placeholder="Senha" id="senha_input"></label>
                                <div id="div_erros_login"></div>
                                <button onclick="cadastro()" class="btn btn-second">Cadastrar</button>
                            </form>
            
                        </div>
                    </div>
            
                    <!--Tela Login-->
                    <div class="content second-content">
                        <div class="first-column">
                            <h2 class="title title-welcome">Olá amigo!</h2>
                            <p class="description description-primary">Realize seu Cadastro</p>
                            <p class="description description-primary">E faça o seu teste!</p>
                            <button id="Cadastrar" class="btn btn-primary">Cadastrar</button>
                        </div>
                        <div class="second-column">
                            <h2 class="title title-second">Entre na sua Conta!</h2>
                            <div class="social-media">
                                <ul class="list-social-media">
                                    <a class="link-social-media" href="#">
                                        <li class="item-social-media">
                                            <i class="fa-brands fa-github"></i>
                                        </li>
                                    </a>
                                    <a class="link-social-media" href="#">
                                        <li class="item-social-media"><i class="fa-brands fa-linkedin"></i>
                                        </li>
                                    </a>
                                    <a class="link-social-media" href="#">
                                        <li class="item-social-media"><i class="fa-brands fa-instagram"></i>
                                        </li>
                                    </a>
                                </ul>
                            </div>
                            <p class="description description-second">ou use seu email e senha para entrar:</p>
                            <form class="form" onsubmit="return false">
                                <label class="label-input" for="">
                                    <i class="fa-solid fa-envelope icon-modify"></i>
                                <input type="text" placeholder="E-mail" id="input_email">
                                </label>
                                <label class="label-input" for="">
                                    <i class="fa-solid fa-lock icon-modify"></i>
                                <input type="text" placeholder="Senha" id="input_senha"></label>
                                <button class="btn btn-second" onclick="login()">Login</button>
                            </form>
                        </div>
                    </div>
                </div>
                
            
              </div>
             
          </div>
      </div>
  </section>
</body>
</html>
<script>

var logar = document.querySelector("#Logar")
var cadastrar = document.querySelector("#Cadastrar")

var body = document.querySelector("body")

logar.addEventListener("click",function(){
    body.className = "login-js";
})

cadastrar.addEventListener("click",function(){
    body.className = "cadastro-js";
})


    // Array para armazenar empresas cadastradas para validação de código de ativação 
    let listaEmpresasCadastradas = [];


    function cadastro() {
      // aguardar();
  
      //Recupere o valor da nova input pelo nome do id
      // Agora vá para o método fetch logo abaixo
      var nomeVar = nome_input.value;
      var emailVar = email_input.value;
      var senhaVar = senha_input.value;
  
      // Verificando se há algum campo em branco
  
      // Verificando se o código de ativação é de alguma empresa cadastrada
  
      // Enviando o valor da nova input
      fetch("/usuarios/cadastrar", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({
          // crie um atributo que recebe o valor recuperado aqui
          // Agora vá para o arquivo routes/usuario.js
          nomeServer: nomeVar,
          emailServer: emailVar,
          senhaServer: senhaVar
        }),
      })
        .then(function (resposta) {
          console.log("resposta: ", resposta);
  
          if (resposta.ok) {
            cardErro.style.display = "block";
  
            mensagem_erro.innerHTML =
              "Cadastro realizado com sucesso! Redirecionando para tela de Login...";
  
              body.className = "login-js";
            
  
          } else {
            throw "Houve um erro ao tentar realizar o cadastro!";
          }
        })
        .catch(function (resposta) {
          console.log(`#ERRO: ${resposta}`);
        });
  
      return false;
    }
  
    // Listando empresas cadastradas 
  
    function sumirMensagem() {
      cardErro.style.display = "none";
    }

    function login() {
    const emailVar = input_email.value;
    const senhaVar = input_senha.value;

    if (emailVar === "" || senhaVar === "") {
      alert("Por favor, preencha todos os campos em branco.");
      return false;
    }

    fetch("/usuarios/autenticar", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({
        emailServer: emailVar,
        senhaServer: senhaVar
      })
    })
      .then(function (resposta){
        if (resposta.ok) {
          resposta.json().then(function (json){
            sessionStorage.EMAIL_USUARIO = json.email;
            sessionStorage.NOME_USUARIO = json.nome;
            sessionStorage.ID_USUARIO = json.id;

            alert("Bem-Vindo!");

            window.location.href = "simulador.html";
            // setTimeout(() => {
            //   window.location = "./Dashboard.html";
            // }, 1000);
          });
        } else {
          alert("Houve um erro ao tentar realizar o login!");
        }
      })
      .catch((erro) => console.log("Erro:", erro));
  }

  </script>